# Items ドラッグ＆ドロップ + item_type カラム追加

## 状態: デプロイ済み（item_type 未実装）

## 完了済み

### ドラッグ＆ドロップ（デプロイ済み）
- `components/items/ItemList.vue` — UTable → カスタム table に置換、ドラッグ＆ドロップ対応
- `components/items/ItemBreadcrumbs.vue` — パンくずにドロップゾーン追加（ホーム=ルート移動、フォルダ名=そのフォルダに移動）
- `pages/index.vue` — `@move` / `@drop` ハンドラ追加、moveItem 呼び出し + トースト通知

### モバイル対応（デプロイ済み）
- モバイル（640px以下）: カード型リストレイアウト（画像+名前+カテゴリ+アクション）
- デスクトップ: 従来のテーブルレイアウト（全カラム表示）

### 行クリック動作変更（デプロイ済み）
- 行クリック → ナビゲート（フォルダに入る）に変更（元は詳細表示だった）
- アクション列に詳細ボタン（info icon）追加
- 矢印ナビゲートボタン削除（行クリックで代替）

### 暫定フォルダ判定（デプロイ済み）
- `isFolder()`: barcode, imageUrl, url がなければフォルダ扱い（ヒューリスティック）
- フォルダクリック → ナビゲート、アイテムクリック → 詳細表示
- アイコンも `isFolder()` で folder/cube を切り替え

## 未完了: item_type カラム追加

ユーザーが「item_type カラム追加」方式を選択済み。以下を実装する必要がある。

### 変更が必要なファイル

1. **Proto**: `packages/logi-proto/proto/items.proto`
   - `string item_type = 15;` を Item message に追加（値: "folder" / "item"）
   - CreateItemReq にも `string item_type` 追加

2. **マイグレーション**: `migrations/00031_add_item_type_to_items.sql`（番号は要確認）
   - `ALTER TABLE items ADD COLUMN item_type TEXT NOT NULL DEFAULT 'item';`
   - 既存データ: barcode/imageUrl/url がないものを 'folder' に UPDATE

3. **Rust モデル**: `src/models/item.rs`
   - `pub item_type: String` フィールド追加

4. **Rust サービス**: `src/services/items_service.rs`
   - CREATE/UPDATE/LIST の全クエリに item_type を含める

5. **フロントエンド ItemList.vue**: `components/items/ItemList.vue`
   - `isFolder()` を `item.itemType === 'folder'` に変更（ヒューリスティック廃止）

6. **フロントエンド ItemForm.vue**: `components/items/ItemForm.vue`
   - 作成時に「フォルダ」/「アイテム」選択UIを追加

7. **logi-proto npm パッケージ**: `git push` で pre-push フックが自動ビルド・公開

### デプロイ順序
1. マイグレーション実行（`sqlx migrate run`）
2. rust-logi デプロイ（`./deploy.sh`）
3. logi-proto npm パッケージ公開（`cd packages/logi-proto && git push`）
4. nuxt-items ビルド＆デプロイ（`npm run build && npx wrangler deploy`）

## 現在デプロイ済みの nuxt-items 変更ファイル
- `components/items/ItemList.vue` — カスタムテーブル + D&D + モバイルカードレイアウト + isFolder ヒューリスティック
- `components/items/ItemBreadcrumbs.vue` — ドロップゾーン付きパンくず
- `pages/index.vue` — moveItem / breadcrumbDrop ハンドラ + searchMode prop
