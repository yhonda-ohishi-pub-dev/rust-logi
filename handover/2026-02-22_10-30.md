# nuxt-items フロントエンド調整 + 次回タスク

## 完了

### auth-worker: OAuth トップページに物品管理を追加
- `src/handlers/top-page.ts` — `originToApp()` に nuxt-items マッピング追加（名前: 物品管理、アイコン: 箱、緑）
- `src/lib/top-html.ts` — `.app-icon-items` CSS + iconClass 判定追加
- `wrangler.toml` — `ALLOWED_REDIRECT_ORIGINS` に `https://items.mtamaramu.com` 追加
- デプロイ済み

### nuxt-items: カスタムドメイン設定
- `wrangler.toml` — `items.mtamaramu.com` カスタムドメイン追加
- 理由: `.workers.dev` ドメインでは `.mtamaramu.com` の JWT cookie が届かず、SSRミドルウェアが毎回ログインにリダイレクトしていた
- デプロイ済み

### nuxt-items: UI調整
- 新規ボタン: FAB（画面右下固定）→ テーブル右上の `+ 新規` ボタンに変更
- OwnerTypeToggle: 「すべて」ボタン削除、「組織」「個人」のみ、デフォルト「組織」
- ヘッダー右上レイアウト: `[アカウント名+プロバイダ] [組織|個人] [URL共有|設定|Logout]`
- AuthToolbar の明示的 import 追加（auto-import ではコンポーネント解決に問題あり）
- デプロイ済み

### テスト項目作成
- `/home/yhonda/.claude/plans/concurrent-hugging-rossum.md` — 全12カテゴリ47項目

## 変更ファイル一覧

### auth-worker (`/home/yhonda/js/auth-worker/`)
- `src/handlers/top-page.ts` — nuxt-items app entry 追加
- `src/lib/top-html.ts` — items 用 CSS + iconClass
- `wrangler.toml` — ALLOWED_REDIRECT_ORIGINS 更新

### nuxt-items (`/home/yhonda/js/nuxt-items/`)
- `wrangler.toml` — カスタムドメイン `items.mtamaramu.com`
- `pages/index.vue` — レイアウト変更、AuthToolbar 明示的 import
- `components/items/OwnerTypeToggle.vue` — 「すべて」削除
- `composables/useItems.ts` — デフォルト ownerType を `'org'` に変更

## 未着手: 組織 slug 表示

### 要件
- ヘッダーに現在ログイン中の組織 slug を表示したい

### 調査メモ
- JWT claims に `org_slug` が含まれている（`src/services/auth_service.rs:28` — `pub org_slug: String`）
- auth-client の `useAuth()` は現在 `org_slug` を expose していない
- `AuthState` interface に `orgSlug` を追加し、`decodeJwtClaims` / `recoverFromCookie` / `consumeFragment` で抽出する必要がある

### 実装案
1. **auth-client** (`auth-worker/packages/auth-client/src/useAuth.ts`):
   - `AuthState` に `orgSlug?: string` 追加
   - `decodeJwtClaims()` で `payload.org_slug` を抽出
   - `recoverFromCookie()` で `payload.org_slug` を抽出
   - `useAuth()` の return に `orgSlug` computed 追加
2. **auth-client** バージョン bump + publish
3. **nuxt-items**: ヘッダーに slug 表示（`useAuth().orgSlug` を使用）
4. **他フロント（carins, dtako-logs）**: 必要に応じて同様に表示
