# 組織 slug 表示完了 + 複数組織対応（次回タスク）

## 完了

### auth-client: orgSlug 対応 (v0.1.7 → v0.1.8)
- `AuthState` に `orgSlug?: string` 追加
- `decodeJwtClaims()` / `consumeFragment()` / `recoverFromCookie()` / `loadFromStorage()` で JWT の `org_slug` claim を抽出
- `orgSlug` computed プロパティ追加
- `AuthToolbar` に `showOrgSlug` prop 追加（default: false）
- `ownerType` / `setOwnerType()` 追加 — 個人モード時に org slug を自動非表示
- commit: `e41dba1`, `60673af` — push & publish 済み

### nuxt-items: OwnerTypeToggle に org slug 表示
- `OwnerTypeToggle.vue` — 「組織」ラベルを org slug で動的表示（fallback: '組織'）
- `pages/index.vue` — `setAuthOwnerType()` で ownerType を auth-client に同期
- auth-client `0.1.8` にアップデート済み
- デプロイ済み: `items.mtamaramu.com`

## 変更ファイル一覧

### auth-worker (`/home/yhonda/js/auth-worker/`)
- `packages/auth-client/src/useAuth.ts` — orgSlug, ownerType, setOwnerType 追加
- `packages/auth-client/src/AuthToolbar.vue` — showOrgSlug prop, ownerType 自動判定

### nuxt-items (`/home/yhonda/js/nuxt-items/`)
- `components/items/OwnerTypeToggle.vue` — org slug ラベル表示
- `pages/index.vue` — useAuth import, setAuthOwnerType 連携

## 次回タスク: 複数組織対応

### 背景
現在の JWT は単一の `org` / `org_slug` しか持てない。ユーザーが複数の組織に所属する場合の対応が必要。

### 現状の構造
- `Claims` struct (`src/services/auth_service.rs:18-29`):
  - `org: String` — 単一の organization_id
  - `org_slug: String` — 単一の slug
- ログイン時に1組織のみ JWT に含まれる
- `members` テーブルで user ↔ organization の多対多関係は既にサポート

### 実装方針案
1. **ログインフロー変更**: ログイン後にユーザーの所属組織一覧を取得し、複数ある場合は組織選択画面を表示
2. **組織切り替え機能**: ログイン後に別組織への切り替え（新しい JWT を発行）
3. **auth-worker**: 組織選択 UI + `/api/switch-org` エンドポイント
4. **rust-logi**: `MemberService` から所属組織一覧を取得する RPC（既存 or 新規）

### 関連ファイル
- `src/services/auth_service.rs` — JWT 発行（`issue_jwt`）
- `src/services/member_service.rs` — メンバー管理
- `src/models/mod.rs` — Member モデル
- `migrations/` — members テーブル定義
- `auth-worker/src/handlers/` — ログインハンドラ群
- `auth-worker/packages/auth-client/src/useAuth.ts` — フロント認証状態
